# Detect operating system
if [[ "$OSTYPE" == "msys" || "$OSTYPE" == "win32" || "$OSTYPE" == "cygwin" ]]; then
  # Windows environment - simple execution
  pnpm exec lint-staged
else
  # macOS/Linux environment - full setup

  # Load nvm (adjust if you don't use it)
  export NVM_DIR="$HOME/.nvm"
  [ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"
  [ -f .nvmrc ] && nvm use >/dev/null 2>&1

  # Ensure PNPM_HOME in PATH
  export PNPM_HOME="$HOME/.local/share/pnpm"
  export PATH="$PNPM_HOME:$PATH"

  # Optionally enable corepack (safe no-op if already enabled)
  if ! command -v pnpm >/dev/null 2>&1; then
    if command -v corepack >/dev/null 2>&1; then
      corepack enable >/dev/null 2>&1
    fi
  fi

  # Fallback if still no pnpm
  if ! command -v pnpm >/dev/null 2>&1; then
    echo "pnpm not found; aborting pre-commit (ensure PNPM_HOME or install pnpm)"
    exit 1
  fi

  pnpm exec lint-staged
fi